# name: Auto-Deploy
# on:
#   push:
#     branches: [ "main" ]

# jobs:
#   deploy:
#     runs-on: self-hosted  # Use your self-hosted runner
#     steps:
#       - name: Checkout Code
#         uses: actions/checkout@v4

#       - name: Stop Server (if running)
#         run: |
#           Get-Process uvicorn -ErrorAction SilentlyContinue | Stop-Process -Force

#       - name: Update Code & Install Dependencies
#         run: |
#           git pull origin main
#           pip install -r requirements.txt

#       - name: Start Server
#         run: |
#           Start-Process -NoNewWindow -FilePath "uvicorn" -ArgumentList "main:app --host 0.0.0.0 --port 8000"

#       # Added by Chat GPT
#       - name: Set execution policy to Unrestricted
#         run: |
#             powershell -Command "Set-ExecutionPolicy Unrestricted -Scope Process -Force"
        


# name: Auto-Deploy

# on:
#   push:
#     branches: [ "main" ]

# jobs:
#   deploy:
#     runs-on: self-hosted

#     #adding comments
#     steps:
#       - name: Checkout Code
#         uses: actions/checkout@v4

#       - name: Kill Existing Uvicorn Server
#         shell: cmd
#         run: |
#           taskkill /IM uvicorn.exe /F || echo "uvicorn not running"

#       - name: Activate Conda Environment and Install Dependencies
#         shell: cmd
#         run: |
#           call C:\Users\LT\AppData\Local\anaconda3\Scripts\activate.bat actions
#           pip install -r requirements.txt

#       - name: Start Uvicorn Server
#         shell: cmd
#         run: |
#           call C:\Users\LT\AppData\Local\anaconda3\Scripts\activate.bat actions
#           start "" uvicorn main:app --host 0.0.0.0 --port 8000








name: Auto-Deploy

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # (Optional) Just log that we're skipping kill step
      - name: Skip Killing Uvicorn
        run: echo "Skipping killing uvicorn.exe to avoid permission errors."

      - name: Activate Conda Environment and Install Dependencies
        shell: cmd
        run: |
          call C:\Users\LT\AppData\Local\anaconda3\Scripts\activate.bat actions
          pip install -r requirements.txt

      - name: Start Uvicorn Server
        shell: cmd
        run: |
          call C:\Users\LT\AppData\Local\anaconda3\Scripts\activate.bat actions
          start "" uvicorn main:app --host 0.0.0.0 --port 8000
